<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Linux Desktop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
  margin:0;
  width:100%;
  height:100%;
  background:#000;
  color:#fff;
  font-family: monospace;
  overflow:hidden;
}
#login{
  position:fixed;
  inset:0;
  background:#000;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:8px;
}
#login input{
  width:260px;
  background:#000;
  color:#fff;
  border:1px solid #555;
  padding:6px;
}
#login button{
  background:#000;
  color:#fff;
  border:1px solid #555;
  padding:6px 12px;
}

#terminal{
  position:absolute;
  inset:0;
  display:none;
  flex-direction:column;
}
#top{
  height:30px;
  border-bottom:1px solid #444;
  display:flex;
  align-items:center;
  gap:6px;
  padding:0 6px;
}
button{
  background:#000;
  color:#fff;
  border:1px solid #555;
  font-size:10px;
}
#out{
  flex:1;
  padding:6px;
  overflow:auto;
  white-space:pre-wrap;
  font-size:11px;
}
#cmd{
  background:#000;
  color:#fff;
  border:none;
  outline:none;
  padding:10px;
  font-size:16px;
}
#desktop{
  position:absolute;
  inset:30px 0 0 0;
  display:none;
  padding:10px;
}
.icon{
  width:64px;
  text-align:center;
  font-size:10px;
}
.icon img{width:40px}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <div>GitHub Gist Backup Login</div>
  <input id="gist" placeholder="Gist ID">
  <input id="token" placeholder="GitHub Token">
  <button onclick="doLogin()">Login</button>
  <div id="loginMsg"></div>
</div>

<!-- TERMINAL -->
<div id="terminal">
  <div id="top">
    <button onclick="showTerminal()">Terminal</button>
    <button onclick="showDesktop()">Desktop</button>
  </div>
  <div id="out">Linux Desktop
Type: help basic</div>
  <input id="cmd" placeholder="type command...">
</div>

<!-- DESKTOP -->
<div id="desktop">
  <div class="icon" onclick="showTerminal()">
    <img src="https://upload.wikimedia.org/wikipedia/commons/a/af/Tux.png">
    <div>Terminal</div>
  </div>
</div>

<script>
let OWNER_GIST_ID="";
let OWNER_TOKEN="";
let UID="user_"+Math.random().toString(36).slice(2);
let customCmd={};

const out=document.getElementById("out");
const cmd=document.getElementById("cmd");

function print(t){
  out.textContent+="\n"+t;
  out.scrollTop=out.scrollHeight;
}
function showTerminal(){
  terminal.style.display="flex";
  desktop.style.display="none";
  cmd.focus();
}
function showDesktop(){
  terminal.style.display="none";
  desktop.style.display="block";
}

/* LOGIN */
function doLogin(){
  let g=document.getElementById("gist").value.trim();
  let t=document.getElementById("token").value.trim();
  if(!g||!t){
    loginMsg.textContent="Gist ID & Token wajib";
    return;
  }
  fetch("https://api.github.com/gists/"+g,{
    headers:{Authorization:"token "+t}
  })
  .then(r=>{
    if(!r.ok) throw "fail";
    return r.json();
  })
  .then(d=>{
    OWNER_GIST_ID=g;
    OWNER_TOKEN=t;
    document.getElementById("login").style.display="none";
    document.getElementById("terminal").style.display="flex";
    loadBackup(d);
  })
  .catch(()=>{
    loginMsg.textContent="Token / Gist invalid";
  });
}

/* BACKUP */
function save(){
  localStorage.setItem("customCmd",JSON.stringify(customCmd));
  fetch("https://api.github.com/gists/"+OWNER_GIST_ID,{
    method:"PATCH",
    headers:{
      Authorization:"token "+OWNER_TOKEN,
      "Content-Type":"application/json"
    },
    body:JSON.stringify({
      files:{
        "backup.json":{
          content:JSON.stringify(customCmd)
        }
      }
    })
  });
}
function loadBackup(d){
  if(d.files && d.files["backup.json"]){
    customCmd=JSON.parse(d.files["backup.json"].content);
    localStorage.setItem("customCmd",JSON.stringify(customCmd));
    print("cloud restore ok");
  }
}

/* TERMINAL */
cmd.onkeydown=e=>{
  if(e.key==="Enter"){
    run(cmd.value.trim());
    cmd.value="";
  }
};

function run(c){
  if(!c)return;
  print("> "+c);
  let a=c.split(" ");

  if(customCmd[a[0]]){
    try{eval(customCmd[a[0]])}
    catch{print("command error")}
    return;
  }

  if(a[0]==="help"){help(a[1]);return;}
  if(a[0]==="clear"){out.textContent="";return;}
  if(a[0]==="desktop"){showDesktop();return;}
  if(a[0]==="terminal"){showTerminal();return;}
  if(a[0]==="pkg"){
    if(a[1]==="import")importCmd();
    if(a[1]==="list")Object.keys(customCmd).forEach(x=>print("- "+x));
    return;
  }
  print("command not found");
}

/* HELP */
function help(x){
  if(!x||x==="basic"){
    print("clear        clear terminal");
    print("pkg          command package system");
    print("desktop      open desktop");
    print("terminal     open terminal");
    print("help (cmd)   command help");
    return;
  }
  if(x==="pkg"){
    print("pkg import   add JS or HTML command");
    print("pkg list     list custom commands");
  }
  if(x==="clear")print("clear terminal output");
  if(x==="desktop")print("switch to desktop ui");
  if(x==="terminal")print("switch to terminal ui");
}

/* PKG IMPORT */
function importCmd(){
  let type=prompt("1=JS  2=HTML");
  let name=prompt("command name:");
  if(!type||!name)return;

  if(type==="1"){
    let code=prompt("JS code:");
    customCmd[name]=code;
  }
  if(type==="2"){
    let html=prompt("HTML:");
    customCmd[name]=`
      let w=window.open("","_blank");
      w.document.write(\`${html.replace(/`/g,"\\`")}\`);
    `;
  }
  save();
  print("command added: "+name);
}
</script>
</body>
</html>